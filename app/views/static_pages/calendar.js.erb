$( document ).ready(
	function () {
		$( "#datepicker" ).datepicker();
		$( "#datepicker" ).datepicker( "option", "dateFormat", "yy-mm-dd" );
		$(".animsition").animsition(
		{
			inClass			:	'fade-in',
			outClass		:	'fade-out',
			inDuration		:	1500,
			outDuration		:	800,
			linkElement		:	'.animsition-link',
			loading			:	true,
			loadingParentElement	:	'body', //animsition wrapper element
			loadingClass			:	'animsition-loading',
			unSupportCss			: [ 'animation-duration','-webkit-animation-duration','-o-animation-duration'],

			overlay					:	false,
			overlayClass			:	'animsition-overlay-slide',
			overlayParentElement  :   'body'
		});
		handleRefresh1();
		
		var theme = getDemoTheme(),
			majorTicks = { size: '15%', interval: 10 },
			minorTicks = { size: '5%', interval: 2.5, style: { 'stroke-width': 1, stroke: '#aaaaaa'} },
			labels = { interval: 10 };

			temperaturechart = new Highcharts.Chart({
			chart: {
				renderTo: 'gauge',
				type: 'spline',
				zoomType: 'x',
				spacingRight: 20,
			},
			title: {
				text: ''
			},
			xAxis: {
				type: 'datetime',
			},
			yAxis: {
				minPadding: 0.2,
				title: {
					text: 'Gradi (Celsius)',
				}
			},
			tooltip: {
				shared: true,
				xDateFormat: '%d/%m/%Y %H:%M:%S' 
			},
			legend: {
				enabled: false
			},
			plotOptions: {
			area: {   
				fillColor: {
					linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
					stops: [
								[0, "#FF0000"],
								[1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(10).get('rgba')]
							]
					},
					lineWidth: 1,
					marker: {
						enabled: false
					},
					shadow: false,
					states: {
						hover: {
								lineWidth: 1
							}
						},
						threshold: null
					}
				},
				series: [
					{
						type: 'area',
						name: 'Temperatura',
						pointInterval: 24 * 3600 * 1000,
						data: [],
					},
					{
						type: 'line',
						name: 'Temperatura Interna',
						pointInterval: 24 * 3600 * 1000,
						data: [],
						lineWidth: 2,
						marker: { fillColor: '#A5B7CD', radius: 10 },
						color: '#A5B7CD',
					}
				]
		});
	}
);
$( "#datepicker" ).change(
	function () {
		handleRefresh1();
	}
);

function handleRefresh1()
{
	
	var url ="http://meteo.ozzyboshi.com:8888/WeatherStation/MeteoServices/Readings/readingsByDay/updateMeteoReadings?date="+getQueryDate()+"&filtro=42";
	var newScriptElement = document.createElement("script");
	newScriptElement.setAttribute("src",url);
	newScriptElement.setAttribute("id","jsonp");
			
	var oldScriptElement = document.getElementById("jsonp");
	var head = document.getElementsByTagName("head")[0];
	if (oldScriptElement == null) {
		head.appendChild(newScriptElement);
	}
	else
	{
		head.replaceChild(newScriptElement, oldScriptElement);	
	}
}


function updateMeteoReadings(letture) 
{
	var array = new Array();
	var array2 = new Array();
	temperaturechart.series[0].setData([]);
	var date;
	var newDate;
	temperaturechart.setTitle({text: "Temperatura per il giorno "+getQueryDate()});
	for (var i=0;i<letture.length;i++)
	{		
		date = new Date(String(letture[i].data).replace(" ","T")+"Z");
		array[i]=[date.getTime()+(date.getTimezoneOffset()*-1)*60*1000,eval(letture[i].temperatura_esterna)];
		array2[i]=[date.getTime()+(date.getTimezoneOffset()*-1)*60*1000,eval(letture[i].temperatura_interna)];
	}
	temperaturechart.series[0].setData(array,true);
	temperaturechart.series[1].setData(array2,true);
}

function getQueryDate()
{
	var datapicker=$("#datepicker").val();
	if (datapicker=="")
		datapicker=new Date().toISOString().substring(0,10);
	return datapicker;
}
