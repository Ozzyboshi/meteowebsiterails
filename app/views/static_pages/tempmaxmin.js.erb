$(document).ready(function () {

	print_termometro($('#termometromax'));
	print_termometro($('#termometromin'));

	var urlmax="http://meteo.ozzyboshi.com:8888/WeatherStation/MeteoServices/Readings/lastMaxReading/updateMeteoMax"
	var urlmin="http://meteo.ozzyboshi.com:8888/WeatherStation/MeteoServices/Readings/lastMinReading/updateMeteoMin"
	
	handleRefresh(urlmax,"jsonpmax");
	setInterval(function () {handleRefresh(urlmax)}, 30000);

	handleRefresh(urlmin,"jsonpmin");
	setInterval(function () {handleRefresh(urlmin)}, 30000);
	
});

function handleRefresh(url,componentID) {
	var newScriptElement = document.createElement("script");
	newScriptElement.setAttribute("src",url);
	newScriptElement.setAttribute("id",componentID);

	var oldScriptElement = document.getElementById(componentID);
	var head = document.getElementsByTagName("head")[0];
	if (oldScriptElement == null)
		head.appendChild(newScriptElement);
	else{
		head.replaceChild(newScriptElement, oldScriptElement);	
	}
}
function updateMeteoMax(sales) {
	var date = new Date(String(sales[0].data).replace(" ","T")+"Z");
	
	$("#termometromaxdesc").text(sales[0].temperatura_esterna*1+" °"+" registrata alle "+date.toString());
	$('#termometromax').jqxLinearGauge('animationDuration', 1000);
	$('#termometromax').jqxLinearGauge('value',sales[0].temperatura_esterna*1);
}

function updateMeteoMin(sales) {
	var date = new Date(String(sales[0].data).replace(" ","T")+"Z");
	$("#termometromindesc").text(sales[0].temperatura_esterna*1+" °"+" registrata alle "+date.toString());
	$('#termometromin').jqxLinearGauge('animationDuration', 1000);
	$('#termometromin').jqxLinearGauge('value',sales[0].temperatura_esterna*1);
}

function print_termometro(divobjectselector)
{
	var theme = getDemoTheme(),
				majorTicks = { size: '15%', interval: 10 },
				minorTicks = { size: '5%', interval: 2.5, style: { 'stroke-width': 1, stroke: '#aaaaaa'} },
				labels = { interval: 10 };
				
	divobjectselector.jqxLinearGauge({
				orientation: 'vertical',
				labels: labels,
				ticksMajor: majorTicks,
				ticksMinor: minorTicks,
				max: 60,
				value: -60,
				pointer: { size: '6%', style: { fill: '#FF0000'} },
				colorScheme: 'scheme05',
	});
	divobjectselector.jqxLinearGauge({ pointer: { pointerType: 'default', size: '5%', visible: true, offset: -5,style: { fill: '#FF0000'}}});
	divobjectselector.jqxLinearGauge({height: 250 });
	divobjectselector.jqxLinearGauge({width: 100 })
	divobjectselector.jqxLinearGauge({min: -10 });
}

